<html>
<head>
  <link rel="stylesheet" type="text/css" href="bower_components/c3/c3.min.css"></link>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
<style>
  #cfrange {
    position: absolute;
    left: 0px;
    top: 150px;
    display:none;
    width: 200px;
    background-color:white;
    //border: 1px solid #000000;

}

</style>
</head>
<body ng-app="myApp" ng-controller="personCtrl" ng-init="showGraph();cfshowGraph()">
<h2>Account Value</h2>
<div id="chart"></div>
<h2>Cash flow</h2>
<div id="cashflow" width="60%"></div>
<div id="cfrange" >
  <input type="range" ng-change="updateCashFlow(this)" ng-model="tmpVal" min="-10000" max="10000" class="mdl-slider mdl-js-slider" >
  {{tmpVal}}
</div>

<div id="cashInOut" width="30%">
</div>
{{inflow}} {{outflow}}

<script src="bower_components\d3\d3.min.js"></script>
<script src="bower_components\c3\c3.min.js"></script>
<script src="bower_components\angular\angular.min.js"></script>
<script src="bower_components\c3-angular\c3-angular.min.js"></script>

</body>
</html>

<script>
var app = angular.module('myApp', ['gridshore.c3js.chart']);
var selectedYear = 0;
var accvalArr = ['data1']
var cashflowArr = ['data1']


app.controller('personCtrl', function($scope) {
    $scope.chart = null;
    $scope.inflow = 0
    $scope.outflow = 0


    for(i=1; i < 60; i++) {
      accvalArr[i] = 100000 + i * 500 * i
      cashflowArr[i] = 0
    }

    $scope.updateCashFlow = function() {
      cashflowArr[selectedYear + 1] = parseInt($scope.tmpVal)
      $scope.cfshowGraph()

      setTimeout(function() {   d3.selectAll("#cfrange")
        .style(
          {
            'display': 'none',
          })
          }, 3000);

      var cfArr = cashflowArr.slice(0)
      cfArr.shift()

      console.log(cfArr)

      $scope.inflow = cfArr.reduce(

        function(total=0, num) {
          return (num > 0 ? total : total - (num))
        },
        0)

      $scope.outflow = cfArr.reduce(
                function(total=0, num) {
          return (num < 0 ? total : total + (num))
        },
      0)

      $scope.cfshowPieGraph()

    }

    $scope.showGraph = function() {
        $scope.chart = c3.generate({
                bindto: '#chart',
                data: {
                  columns: [
                   accvalArr
                  ],
                  onclick: $scope.clickEvent,
                  types: {
                    'data1':'bar'
                  }
                }
            });
    }

    $scope.cfshowGraph = function() {
        $scope.cfchart = c3.generate({
                bindto: '#cashflow',
                data: {
                  columns: [
                    cashflowArr
                  ],
                  onclick: $scope.clickEvent,
                  types: {
                    'data1':'bar'
                  }
                }
            });
    }

    $scope.cfshowPieGraph = function() {
        $scope.cfchart = c3.generate({
                bindto: '#cashInOut',
                data: {
                  columns: [
                    ['Inflow', $scope.outflow],
                    ['Outflow', $scope.inflow]
                  ],
                  type : 'pie',
                }
            });
    }

    $scope.clickEvent = function(d) {
      d3.selectAll("#cfrange")
        .style(
          {
            'left': d3.event.pageX - 50 + 'px',
            'top': d3.event.pageY + 'px',
            'display': 'block',
          })
       selectedYear = d.x;


       $scope.$apply(function() {
       $scope.tmpVal = cashflowArr[selectedYear + 1]
        });
    }

});

d3.select('body').on('click', function(){
  //console.log('msg is'+  (d3.event.pageX) );
})





</script>
